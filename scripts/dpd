#!/bin/bash
SCRIPT=$0
DIRNAME=`dirname $SCRIPT`
node - <<'JS' $DIRNAME $*
let [ SCRIPT, DASH, DIRNAME, ...args] = process.argv;
(async function() {
  const path = (await import('path'));
  const fs = (await import('fs'));
  const { promises: fsp } = fs;
  const { fileURLToPath } = (await import('url'));
  const { default:Dictionary } = (await import(
    `${DIRNAME}/../src/dictionary.mjs`));

  let dict =  await Dictionary.create();
  for (let i=0; i<args.length; i++) {
    let word = args[i];
    let info = dict.entryOf(word);
    if (info == null) {
      console.log(`${word} (not found)`);
      return;
    }
    let { definition } = info;
    console.log(word);
    console.log("=".padEnd(word.length, "="));
    let typePad = 1;
    let constrPad = 1;
    let lines = definition.map(line=>{
      let [ type, meaning, literal, construction ] = line.split('|');
      typePad = Math.max(typePad, type.length);
      constrPad = Math.max(constrPad, construction.length);
      return [type, meaning, literal, construction ];
    });
    lines.forEach((line,i)=>{
      let [ type, meaning, literal, construction] = line;
      console.log(
        `${i+1}`.padStart(2),
        type.padEnd(typePad+1),
        construction.padEnd(constrPad+1),
        `${meaning}${literal && ("; lit."+literal)}`,
      );
    });
  }
})()
JS
